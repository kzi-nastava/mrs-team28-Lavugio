@if (!isHidden()){
    <div
    class="flex flex-col w-full sm:max-w-md 
            bg-green-50 rounded-xl shadow-lg justify-center
            font-[Inter]">

    <h2
    class="relative text-lg sm:text-xl font-semibold
            px-4 py-3 text-[#FEFAE0]
            bg-[#2D6A4F]
            rounded-t-xl">

        <span>
            Ocenite vožnju
        </span>

        <button
        type="button"
        class="absolute right-3 top-1/2 -translate-y-1/2
            text-[#FEFAE0] text-xl
            hover:opacity-80
            transition
            font-extralight
            hover:cursor-pointer"
        (click)="ngOnDestroy()">
            x
        </button>
    </h2>


    <div class="flex flex-col p-4 gap-4">
        @if (isDone()) {
            <div class="flex flex-col items-center justify-center gap-3 p-3">

                <p class="text-base sm:text-lg font-medium text-[#1B4332] text-center">
                    Hvala na oceni!
                </p>

                <p class="text-sm text-[#40916C] text-center max-w-xs">
                    Vaše mišljenje nam pomaže da poboljšamo uslugu.
                </p>

                <button
                class="mt-2 px-6 py-2 rounded-lg
                        w-full sm:w-auto
                        bg-[#2D6A4F] text-[#FEFAE0]
                        font-semibold
                        hover:bg-[#245741]
                        active:scale-95
                        transition hover:cursor-pointer"
                (click)="ngOnDestroy()">
                Zatvori
                </button>
            </div>
        } @else {
            <!-- Ocena vozača -->
            <div class="flex flex-col gap-2">
                <label class="text-sm font-medium text-[#1B4332]">
                    Ocena vozača
                </label>
                <div class="flex gap-1 justify-center">
                    @for (star of [1, 2, 3, 4, 5]; track star) {
                        <button
                        type="button"
                        (click)="setDriverRating(star)"
                        class="hover:scale-110 transition hover:cursor-pointer">
                            <svg 
                            class="w-8 h-8 sm:w-10 sm:h-10"
                            [class.text-yellow-400]="star <= driverRating()"
                            [class.text-gray-300]="star > driverRating()"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                        </button>
                    }
                </div>
            </div>

            <!-- Ocena vozila -->
            <div class="flex flex-col gap-2">
                <label class="text-sm font-medium text-[#1B4332]">
                    Ocena vozila
                </label>
                <div class="flex gap-1 justify-center">
                    @for (star of [1, 2, 3, 4, 5]; track star) {
                        <button
                        type="button"
                        (click)="setVehicleRating(star)"
                        class="hover:scale-110 transition hover:cursor-pointer">
                            <svg 
                            class="w-8 h-8 sm:w-10 sm:h-10"
                            [class.text-yellow-400]="star <= vehicleRating()"
                            [class.text-gray-300]="star > vehicleRating()"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                        </button>
                    }
                </div>
            </div>

            <!-- Komentar -->
            <div class="flex flex-col gap-2">
                <label class="text-sm font-medium text-[#1B4332]">
                    Komentar (opciono)
                </label>
                <textarea
                [formControl]="commentControl"
                (input)="onInput()"
                (keydown.enter)="onEnterPress($event)"
                [attr.maxlength]="maxLength"
                placeholder="Ostavite komentar o vožnji..."
                class="w-full min-h-24 resize-none
                        rounded-lg border border-[#52B788]
                        p-3 text-sm sm:text-base
                        focus:outline-none focus:ring-1 focus:ring-[#2D6A4F]
                        text-[#1B4332]">
                </textarea>

                <div class="text-xs text-right text-gray-500">
                    {{ commentControl.value.length }} / {{ maxLength }}
                </div>
            </div>

            <button
            [disabled]="driverRating() === 0 || vehicleRating() === 0"
            class="w-full sm:w-1/2 mx-auto
                    py-2 rounded-lg
                    bg-[#2D6A4F] text-[#FEFAE0] font-semibold
                    disabled:opacity-50 disabled:cursor-not-allowed
                    hover:bg-[#245741] active:scale-95
                    transition hover:cursor-pointer"
            (click)="sendReview()">
                @if (isLoading()) {
                    <span class="flex items-center justify-center gap-2">
                    Šaljem...
                   <svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle
                            class="opacity-25"
                            cx="12" cy="12" r="10"
                            stroke="currentColor"
                            stroke-width="4">
                        </circle>
                        <circle
                            class="opacity-75"
                            cx="12" cy="12" r="10"
                            stroke="currentColor"
                            stroke-width="4"
                            stroke-linecap="round"
                            stroke-dasharray="18.84 43.96"
                            stroke-dashoffset="0">
                        </circle>
                    </svg>

                    </span>
                } @else {
                    Pošalji ocenu
                }
            </button>
            @if (isFailed()) {
                <div class="text-sm text-[#2D6A4F] text-center mt-2">
                Neuspešno slanje. Molimo pokušajte ponovo.
                </div>
            }
        }
    </div>
</div>
}