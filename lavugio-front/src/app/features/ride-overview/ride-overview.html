<div class="flex flex-col w-auto min-h-screen">

  <div class="sticky top-0 z-30">
    <app-navbar></app-navbar>
  </div>

  <div class="relative grow w-full">

    <div class="absolute inset-0 z-0">
      <app-map #map></app-map>
    </div>

    @if (isDesktop()) {
      <div
        class="fixed top-20 left-16 w-1/4 h-2/3 mt-10
               shadow-lg z-10 rounded-lg overflow-hidden flex flex-col">
        <app-ride-info
          #rideInfo
          class="w-full h-full flex flex-col"
          [rideOverview]="rideOverview()"
          [isReported]="isReported()"
          [isReviewed]="isRated()"
          (reportClicked)="showReport.set(true)"
          (reviewClicked)="showReview.set(true)"
          (rideCancelled)="cancelRide()">
        </app-ride-info>
      </div>
    }

    @if (!isDesktop()) {
      <div
        class="fixed bottom-0 left-0 right-0 z-20
               transition-all duration-300 ease-in-out
               shadow-2xl overflow-hidden bg-[#606C38]
               rounded-t-2xl"
        [class.h-auto]="!isInfoOpen()"
        [class.h-[60vh]]="isInfoOpen()">

        <div
          class="flex items-center justify-center py-3 cursor-pointer"
          (click)="toggleInfo()">
          <div class="w-12 h-1 bg-[#FEFAE0] rounded-full"></div>
        </div>

        <div
          class="h-[60vh] overflow-y-clip pb-8"
          [class.hidden]="!isInfoOpen()">
          <app-ride-info
            #rideInfo
            class="w-full h-full"
            [rideOverview]="rideOverview()"
            [isReported]="isReported()"
            [isReviewed]="isRated()"
            (reportClicked)="showReport.set(true)"
            (reviewClicked)="showReview.set(true)"
            (rideCancelled)="cancelRide()">
          </app-ride-info>
        </div>
      </div>
    }

    @if (showReport()) {
      <div
        class="fixed inset-0 bg-black/50 z-40"
        (click)="showReport.set(false)">
      </div>

      <div
        class="fixed top-1/2 left-1/2
               -translate-x-1/2 -translate-y-1/2
               z-50 w-[90%] max-w-md">
        <app-report-form
          (isSuccessful)="isReported.set(true)"
          (hideReportOutput)="showReport.set(false)">
        </app-report-form>
      </div>
    }

    @if (showReview()){
      <div
        class="fixed inset-0 bg-black/50 z-40"
        (click)="showReview.set(false)">
      </div>

      <div
        class="fixed top-1/2 left-1/2
               -translate-x-1/2 -translate-y-1/2
               z-50 w-[90%] max-w-md">
        <app-review-form
          (isSuccessfulOutput)="isRated.set(true)"
          (hideReviewOutput)="showReview.set(false)">
        </app-review-form>
      </div>
    }

  </div>
</div>